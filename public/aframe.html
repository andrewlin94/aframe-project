<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>AFRAME FROM EXPRESS! Hello, WebVR! â€¢ A-Frame</title>
    <meta name="description" content="AFRAME FROM EXPRESS!">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe-inspector@master/dist/aframe-inspector.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
</head>

<body>
    <!-- <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("hello");
            console.log(
                "Yay! The readyState just increased to  " +
                "HAVE_CURRENT_DATA or greater for the first time."
            );

            let scene = document.querySelector('a-scene');
            // var cameraTimeout = document.getElementById("nomadsLoading");
            scene.addEventListener("loaded", function (e) {
                nomadsLoading.style.display = "block";
                document.getElementById("animeDemo").style.display = "block";
            });
        });
    </script>
    <script>
        var letterTime = 500;
        var lineDrawing = anime({
            targets: "path",
            strokeDashoffset: [anime.setDashoffset, 0],
            easing: "easeInOutCubic",
            duration: letterTime,
            delay: function (el, i) {
                return letterTime * i;
            },
            begin: function (anim) {
                console.log('begin animation');
                var letters = document.querySelectorAll("path"),
                    i;

                for (i = 0; i < letters.length; ++i) {
                    letters[i].setAttribute("stroke", "#0ff");
                    letters[i].setAttribute("fill", "none");
                }
            },
            update: function (anim) {
                console.log('update animation');
                if (anim.currentTime >= letterTime) {
                    document.querySelector(".letter-1").setAttribute("fill", "#0ff");
                }
                if (anim.currentTime >= 2 * letterTime) {
                    document.querySelector(".letter-2").setAttribute("fill", "#0ff");
                }
                if (anim.currentTime >= 3 * letterTime) {
                    document.querySelector(".letter-3").setAttribute("fill", "#0ff");
                }
                if (anim.currentTime >= 4 * letterTime) {
                    document.querySelector(".letter-4").setAttribute("fill", "#0ff");
                }
            },
            autoplay: false
        });
    </script> -->
    <script>
        let i = 0;
        let j = 0;
        let initialX = 0;
        let initialY = 0;
        let bool = true;
        // AFRAME.registerComponent('camera-reader', {
        //     tick: function () {
        //         // `this.el` is the element.
        //         // `object3D` is the three.js object.
        //         // `rotation` is a three.js Euler using radians. `quaternion` also available.
        //         // console.log(i);
        //         ++i;
        //         // console.log(i);
        //         // console.log((new Date()).getTime());
        //         if (i >= 15) {
        //             // console.log('reset');
        //             i = 0;
        //             if (Math.abs((this.el.object3D.rotation.x - initialX)) < 0.01 && Math.abs((this.el.object3D.rotation.y - initialY)) < 0.01) {
        //                 console.log('Not moving');
        //                 // Not moving
        //                 document.getElementById('box-2').setAttribute('animation', 'property: material.opacity; to: 1.0; delay: 1000; dur: 500; enabled: true;');
        //                 document.getElementById('box-2').addEventListener('animationbegin', () => {
        //                     console.log('animation begin');
        //                     let position = new THREE.Vector3();
        //                     let rotation = new THREE.Euler();
        //                     position = document.getElementById('box').object3D.getWorldPosition(position);
        //                     rotation = document.getElementById('camera').object3D.rotation;
        //                     document.getElementById('box-2').object3D.position.set(position.x, position.y, position.z);
        //                     document.getElementById('box-2').object3D.rotation.set(-Math.asin(position.y / position.z), rotation.y, rotation.z);
        //                 });
        //                 document.getElementById('box-2').addEventListener('animationcomplete', () => {
        //                     document.getElementById('camera').removeAttribute('rotation-reader');
        //                 });
        //                 // document.getElementById('box-2').object3D.position.set()
        //                 // document.getElementById('box-2').object3D.position.set()
        //             }else {
        //                 document.getElementById('box-2').addEventListener('mouseenter', () => {
        //                     document.getElementById('box-2').setAttribute('animation', 'enabled: false;');
        //                     document.getElementById('camera').removeAttribute('rotation-reader');
        //                     document.getElementById('box-2').setAttribute('material', 'opacity: 1.0;');
        //                 })
        //                 document.getElementById('box-2').addEventListener('mouseleave', () => {
        //                     document.getElementById('box-2').setAttribute('animation', 'property: material.opacity; to: 1.0; delay: 1000; dur: 500; enabled: true;');
        //                     document.getElementById('camera').setAttribute('rotation-reader', '');
        //                     document.getElementById('box-2').setAttribute('material', 'opacity: 0.0;');
        //                     // bool = true;
        //                 })
        //                 // document.getElementById('box-2').setAttribute('material', 'opacity: 0.0');
        //             }
        //                 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //                 //     document.getElementById('box').setAttribute('animation', 'property: material.opacity; to: 1.0; delay: 1000; dur: 1000;');
        //                 //     // console.log('attributes', document.getElementById('box-2').getAttribute('material').opacity == 0);
        //                 //     // if (document.getElementById('box-2').getAttribute('material') == 'color: blue; transparent:true; opacity: 0.0;') {
        //                 //     //     console.log('invisible');
        //                 //     // }else {
        //                 //     //     console.log('visible');
        //                 //     // }
        //                 //     if (document.getElementById('box-2').getAttribute('material').opacity == 0) {
        //                 //         document.getElementById('box').addEventListener('animationcomplete', () => {
        //                 //             var position = new THREE.Vector3();
        //                 //             var rotation = new THREE.Euler();
        //                 //             position = document.getElementById('box').object3D.getWorldPosition(position);
        //                 //             // console.log(position);
        //                 //             rotation = document.getElementById('camera').object3D.rotation;
        //                 //             // console.log(rotation);
        //                             document.getElementById('box-2').object3D.position.set(position.x, position.y, position.z);
        // //                 //             // Math formula might change depending on where the menu should appear.
        //                             document.getElementById('box-2').object3D.rotation.set(-Math.asin(position.y / position.z), rotation.y, rotation.z);
        //                 //             document.getElementById('box-2').setAttribute('animation', 'property: material.opacity; to: 1.0; dur: 1; easing: linear;');
        //                 //             // document.getElementById('box').removeAttribute('animation');
        //                 //             // document.getElementById('box-2').removeAttribute('animation');
        //                 //         });
        //                 //     }else if (document.getElementById('box-2').getAttribute('material').opacity == 1) {
        //                 //         document.getElementById('box-2').addEventListener('mouseenter', () => {
        //                 //             console.log('mouse enter');
        //                 //             document.getElementById('box').removeAttribute('animation');
        //                 //             document.getElementById('box').removeEventListener('animationcomplete', () => {});
        //                 //             // document.getElementById('box-2').removeAttribute('animation');
        //                 //             // document.getElementById('box-2').removeEventListener('mouseenter', () => {})
        //                 //         })
        //                 //         document.getElementById('box-2').addEventListener('mouseleave', () => {
        //                 //             console.log('mouse leave');
        //                 //             // document.getElementById('box-2').removeEventListener('mouseleave', () => {})
        //                 //             document.getElementById('box-2').setAttribute('material', 'opacity: 0.0');
        //                 //         })
        //                 //     }
        //                 //     // console.log(document.getElementById('box').getAttribute('position'));
        //                 //     // console.log(this.el.object3D.position);
        //                 //     // document.getElementById('box').setAttribute('animation', 'property: visible; to: true; delay: 1000; dur: 3000; easing: linear');
        //                 //     // document.getElementById('box').setAttribute('visible', 'true');
        //                 // } else {
        //                 //     console.log('moving')
        //                 //     // Moving, stop animation and remove listener
        //                 //     // document.getElementById('box').setAttribute('material', 'opacity: 0.0');
        //                 //     // document.getElementById('box-2').setAttribute('material', 'opacity: 0.0');
        //                 //     document.getElementById('box').removeAttribute('animation');
        //                 //     document.getElementById('box').removeEventListener('animationcomplete', () => {});
        //                 //     document.getElementById('box-2').removeAttribute('animation');

        //                 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //             initialX = this.el.object3D.rotation.x;
        //             initialY = this.el.object3D.rotation.y;
        //         }
        //     }
        // });


        AFRAME.registerComponent('camera-reader', {
            tick: function () {
                ++i;
                // console.log('j', j);
                if (i >= 15) {
                    i = 0;
                    console.log(j);
                    if (Math.abs((this.el.object3D.rotation.x - initialX)) < 0.01 && Math.abs((this.el.object3D.rotation.y - initialY)) < 0.01) {
                        // console.log('not moving');
                        if (j >= 12) {
                            // console.log('add fusing');
                            document.getElementById('cursorToggle').setAttribute('add-fusing', '');
                            // document.getElementById('box-2').removeAttribute('fade-out');
                            // document.getElementById('box-2').setAttribute('fade-in', '');
                            j = 0;
                        }
                        // document.getElementById('box-2').setAttribute('visible-invisible', '');
                        // document.getElementById('box-2').setAttribute('my-animation', '');
                    } else {
                        // console.log('moving');
                        document.getElementById('cursorToggle').removeAttribute('add-fusing');
                        if (j >= 12) {
                            // console.log('remove fusing');
                            document.getElementById('cursorToggle').removeAttribute('add-fusing');
                            // document.getElementById('box-2').removeAttribute('fade-in');
                            // document.getElementById('box-2').setAttribute('fade-out', '');
                            j = 0;
                        }
                        // document.getElementById('box-2').removeAttribute('visible-invisible');
                        // document.getElementById('box-2').removeAttribute('my-animation');
                    }
                    ++j;
                    initialX = this.el.object3D.rotation.x;
                    initialY = this.el.object3D.rotation.y;
                }
            }
        });

        AFRAME.registerComponent('fade-out', {
            init: function () {
                console.log('add fade-out')
                this.el.setAttribute('animation', 'property: material.opacity; to: 0.0; delay: 0; dur: 500; enabled: true;');
                // this.el.addEventListener('mouseenter', () => {
                //     console.log('enter');
                //     // this.el.removeAttribute('my-animation');
                // })
            },
            remove: function () {
                this.el.removeAttribute('animation');
            }
        })

        AFRAME.registerComponent('fade-in', {
            init: function () {
                console.log('add fade-in')
                this.el.setAttribute('animation', 'property: material.opacity; to: 1.0; delay: 0; dur: 500; enabled: true;');
                let position = new THREE.Vector3();
                let rotation = new THREE.Euler();
                position = document.getElementById('box').object3D.getWorldPosition(position);
                rotation = document.getElementById('camera').object3D.rotation;
                document.getElementById('box-2').object3D.position.set(position.x, position.y, position.z);
                // Math formula might change depending on where the menu should appear.
                document.getElementById('box-2').object3D.rotation.set(-Math.asin(position.y / position.z), rotation.y, rotation.z);
                // this.el.addEventListener('mouseenter', () => {
                //     console.log('enter');
                //     // this.el.removeAttribute('my-animation');
                // })
            },
            remove: function () {
                this.el.removeAttribute('animation');
            }
        })

        AFRAME.registerComponent('hey-listen', {
            init: function () {
                this.el.addEventListener('mouseenter', () => {
                    console.log('enter');
                    document.getElementById('box-2').setAttribute('material', 'opacity: 1.0');
                    document.getElementById('box-2').removeAttribute('fade-out');
                    document.getElementById('camera').removeAttribute('camera-reader');
                })
                this.el.addEventListener('mouseleave', () => {
                    console.log('leave');
                    document.getElementById('box-2').setAttribute('material', 'opacity: 0.0');
                    document.getElementById('camera').setAttribute('camera-reader', '');
                })
            }
        })
        // AFRAME.registerComponent('testing', {
        //     init: function () {
        //         this.el.addEventListener('mouseenter', () => {
        //             lineDrawing.restart;
        //         })
        //     }
        // });
        // AFRAME.registerComponent("menu-loading", {
        //     init: function () {
        //         let el = this.el;
        //         let data = this.data;
        //         let controlbar = document.getElementById("nomadsLoading");
        //         let cursor = document.getElementById("cursorToggle");
        //         el.addEventListener("mouseenter", function () {
        //             console.log("Enter");
        //             cursor.setAttribute("visible", "true");
        //             controlbar.setAttribute("visible", "true");
        //             lineDrawing.restart;
        //         });
        //         el.addEventListener("mouseleave", function () {
        //             console.log("Leave");

        //             cursor.setAttribute("visible", "false");
        //             controlbar.setAttribute("visible", "false");
        //         });
        //     }
        // });
        AFRAME.registerComponent('tl-ring-animation', {
            init: function () {
                document.getElementById('cursorToggle').setAttribute('visible', 'false');
                this.el.setAttribute('animation', 'property: theta-length; to: 360; easing: easeInQuad;');
                this.el.addEventListener('animationcomplete', () => {
                    document.getElementById('tr-ring').setAttribute('tr-ring-animation', '');
                });
            },
            remove: function () {
                this.el.removeAttribute('animation');
            }
        });
        AFRAME.registerComponent('tr-ring-animation', {
            init: function () {
                this.el.setAttribute('animation', 'property: theta-length; to: 360; easing: easeInQuad;');
                this.el.addEventListener('animationcomplete', () => {
                    document.getElementById('br-ring').setAttribute('br-ring-animation', '');
                });
            },
            remove: function () {
                this.el.removeAttribute('animation');
            }
        });
        AFRAME.registerComponent('br-ring-animation', {
            init: function () {
                this.el.setAttribute('animation', 'property: theta-length; to: 360; easing: easeInQuad;');
                this.el.addEventListener('animationcomplete', () => {
                    document.getElementById('bl-ring').setAttribute('bl-ring-animation', '');
                });
            },
            remove: function () {
                this.el.removeAttribute('animation');
            }
        });
        AFRAME.registerComponent('bl-ring-animation', {
            init: function () {
                this.el.setAttribute('animation', 'property: theta-length; to: 360; easing: easeInQuad;');
                this.el.addEventListener('animationcomplete', () => {
                    document.getElementById('tl-ring').setAttribute('theta-length', '1');
                    document.getElementById('tr-ring').setAttribute('theta-length', '1');
                    document.getElementById('bl-ring').setAttribute('theta-length', '1');
                    document.getElementById('br-ring').setAttribute('theta-length', '1');

                    document.getElementById('tl-ring').removeAttribute('animation');
                    document.getElementById('tr-ring').removeAttribute('animation');
                    document.getElementById('br-ring').removeAttribute('animation');
                    document.getElementById('bl-ring').removeAttribute('animation');
                    document.getElementById('box-2').setAttribute('fade-in', '');
                });
            },
            remove: function () {
                this.el.removeAttribute('animation');
            }
        });
        AFRAME.registerComponent('cursor-fusing', {
            init: function () {
                this.el.addEventListener('fusing', () => {
                    document.getElementById('tl-ring').setAttribute('tl-ring-animation', '');
                })
            }
        });
        AFRAME.registerComponent('add-fusing', {
            init: function () {
                // this.el.setAttribute('cursor-fusing');
                this.el.setAttribute('fuse', 'true');
                this.el.setAttribute('fuseTimeout', '2000');
                this.el.addEventListener('fusing', () => {
                    document.getElementById('tl-ring').setAttribute('tl-ring-animation', '');
                    console.log('fusing');
                })
            }
        })

    </script>


    <a-scene background="color: #FAFAFA">
        <a-entity id='camera' camera look-controls camera-reader reverseMouseDrag="true">
            <a-entity geometry="primitive: plane;" material="color: blue; transparent:true; opacity: 0.0;" id="box"
                position="0 -1 -3" scale="0 0 0" rotation="0 0 0" shadow></a-entity>
            <a-cursor id="cursorToggle"></a-cursor>
        </a-entity>
        <a-plane position="0 0 -1.01" material="color: red">
            <a-ring id="tl-ring" color="blue" radius-inner="0.005" radius-outer="0.01" theta-length="1" position="-0.01 0 0.05"></a-ring>
            <a-ring id="tr-ring" color="blue" radius-inner="0.005" radius-outer="0.01" theta-length="1" position="0.01 0 0.05"></a-ring>
            <a-ring id="bl-ring" color="blue" radius-inner="0.005" radius-outer="0.01" theta-length="1" position="-0.01 -0.02 0.05"></a-ring>
            <a-ring id="br-ring" color="blue" radius-inner="0.005" radius-outer="0.01" theta-length="1" position="0.01 -0.02 0.05"></a-ring>

        </a-plane>
        <a-entity geometry="primitive: plane;" material="color: blue; transparent: true; opacity: 0.0;" id="box-2"
            rotation="0 0 0" position="0 -1 -3"></a-entity>
        <!-- <a-entity geometry="primitive: box;" material="color: blue; transparent:true; opacity: 0.0;" id="box-2" position="-1 0.5 -3" rotation="0 45 0" shadow></a-entity> -->
        <!-- <a-entity geometry="primitive: box;" material="color: blue" id="box" position="-1 0.5 -3" rotation="0 45 0" shadow visible="false"></a-entity> -->
        <!-- <a-box id="box" position="-1 0.5 -3" rotation="0 45 0" color="blue" shadow visible="false"></a-box> -->
        <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E" shadow></a-sphere>
        <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D" shadow></a-cylinder>
        <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4" shadow></a-plane>
        <!-- <a-plane id="nomadsLoading" position="0 0 -2">
            <div id="loadingCircles">
                <div id="animeDemo">
                    <svg id="prefix__Layer_1" x="0" y="0" width="47px" height="65" xmlspace="preserve" class="taget">
                        <style>
                            .prefix__st4 {
                                fill: #0ff
                            }
                        </style>



                        <path class="letter-1" stroke="none" stroke-width="1" fill="none" id="circle-1"
                            d="M12.9 30c-4.2 0-7.7-3.4-7.7-7.7s3.4-7.7 7.7-7.7 7.7 3.4 7.7 7.7-3.5 7.7-7.7 7.7zm0-13.9c-3.5 0-6.3 2.8-6.3 6.3s2.8 6.3 6.3 6.3 6.3-2.8 6.3-6.3-2.9-6.3-6.3-6.3z">
                        </path>



                        <path class="letter-2" stroke="none" stroke-width="1" fill="none" id="circle-2"
                            d="M33.1 30c-4.2 0-7.7-3.4-7.7-7.7s3.4-7.7 7.7-7.7 7.7 3.4 7.7 7.7-3.4 7.7-7.7 7.7zm0-13.9c-3.5 0-6.3 2.8-6.3 6.3s2.8 6.3 6.3 6.3 6.3-2.8 6.3-6.3-2.8-6.3-6.3-6.3z">
                        </path>



                        <path class="letter-3" stroke="none" stroke-width="1" fill="none" id="circle-3"
                            d="M33.1 50.3c-4.2 0-7.7-3.4-7.7-7.7 0-4.2 3.4-7.7 7.7-7.7s7.7 3.4 7.7 7.7c0 4.3-3.4 7.7-7.7 7.7zm0-13.9c-3.5 0-6.3 2.8-6.3 6.3s2.8 6.3 6.3 6.3 6.3-2.8 6.3-6.3-2.8-6.3-6.3-6.3z">
                        </path>




                        <path class="letter-4" stroke="none" stroke-width="1" fill="none" id="circle-4"
                            d="M12.9 50.3c-4.2 0-7.7-3.4-7.7-7.7 0-4.2 3.4-7.7 7.7-7.7s7.7 3.4 7.7 7.7c-.1 4.3-3.5 7.7-7.7 7.7zm0-13.9c-3.5 0-6.3 2.8-6.3 6.3S9.4 49 12.9 49s6.3-2.8 6.3-6.3c-.1-3.5-2.9-6.3-6.3-6.3z">
                        </path>


                    </svg>

                </div>

                <div class="controls">
                    <button class="show-cursor">BUTTOn</button>
                </div>
            </div>
        </a-plane> -->

    </a-scene>

</body>

</html>